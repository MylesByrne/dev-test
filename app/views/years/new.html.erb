<!-- app/views/years/new.html.erb -->
<h1>New Year</h1>

<%= render "form", year: @year, makes: @makes, models: @models %>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const makeSelect  = document.getElementById('year_make_select');
  const modelSelect = document.getElementById('year_model_select');
  if (!makeSelect || !modelSelect) return;

  makeSelect.addEventListener('change', function() {
    const makeId = this.value;
    if (!makeId) {
      modelSelect.innerHTML = '<option value="">Select Model</option>';
      return;
    }
    modelSelect.innerHTML = '<option value="">Loading...</option>';

    fetch('/car_models/for_make/' + makeId, { headers: { 'Accept': 'application/json' } })
      .then(res => res.json())
      .then(models => {
        modelSelect.innerHTML = '<option value="">Select Model</option>';
        models.forEach(function(m) {
          const opt = document.createElement('option');
          opt.value = m.id;
          opt.text  = m.name;
          modelSelect.appendChild(opt);
        });
      });
  });
});
</script>

<p><%= link_to "Back", years_path %></p>
